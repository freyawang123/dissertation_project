<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>England and Wales Employment and Population Density 3D Map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map-left {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            width: 50%;
        }

        #map-right {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 50%;
        }

        .clearfix {
            zoom: 1;
        }

        /*兼容IE清除浮动*/
        .clearfix:after {
            content: "\200B";
            height: 0;
            display: block;
            visibility: hidden;
            clear: both;
        }

        /*清除浮动*/
        .draggable-bar {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 5px;
            background-color: #111;
            cursor: col-resize;
            z-index: 1000;
        }

        .map-overlay {
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            position: absolute;
            width: 380px;
            min-width: 380px;
            top: 0;
            left: 0;
            padding: 10px;
        }

        .map-overlay .map-overlay-inner {
            background-size: 100% 100%;
            box-shadow: 0 1px 2px rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            padding: 20px 10px 20px 22px;
            margin-bottom: 10px;
            max-width: 360px;
        }

        .map-overlay table {
            border: none;
            width: 100%;
        }

        .map-overlay h2 {
            line-height: 24px;
            display: block;
            margin: 0 0 10px;
            color: #000000;
            font-size: 17px;
        }

        .map-overlay label {
            font: 18px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            display: block;
            margin: 0 0 0 10px;
            padding: 0;
        }

        .map-overlay .legend .bar {
            height: 10px;
            width: 100%;
            background: linear-gradient(to right, #FCA107, #7F3121);
        }

        .map-overlay input {
            background-color: transparent;
            display: inline-block;
            width: 100%;
            min-width: 220px;
            position: relative;
            margin: 6px 0 0 0;
            cursor: ew-resize;
        }

        .map-overlay p.credit {
            margin: 0;
            padding: 0;
            color: #000000;
        }

        .map-overlay.controls {
            display: flex;
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1;
            flex-wrap: wrap;
            max-width: 300px;
        }

        select {
            display: block;
            margin-top: 10px;
            margin-bottom: 10px;
            margin-right: 10px;
            border: 1px solid #000000;
            border-radius: 5px;
            color: #000000;
            float: left;
            font-size: 14px;
        }

        .map-overlay p.buttons {
            display: flex;
            justify-content: space-between;
        }

        .map-overlay button {
            background-size: 100% 100%;
            padding: 5px 22px 5px 36px;
            border: none;
            color: rgb(0, 0, 0);
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 10px 2px;
            cursor: pointer;
            border-radius: 4px;
            opacity: 0.8;
        }

        .map-overlay button:hover {
            background-color: #e77715;
        }

        .map-overlay2 {
            position: absolute;
            bottom: 0;
            /* right: 0; */
            margin-left: 10px;
            border-radius: 5px;
        }

        #legend {
            background-size: 100% 100%;
            background-color: rgba(240, 248, 255, 0.8);
            opacity: 1;
            padding: 10px 20px 30px 20px;
            margin-bottom: 40px;
            line-height: 20px;
            min-height: 140px;
            /* width: 140px; */
        }

        #legend h3 {
            color: rgb(0, 0, 0);
        }

        #legend span {
            color: rgb(0, 0, 0);
        }

        .legend-key {
            display: inline-block;
            width: 10px;
            height: 10px;
            margin-right: 5px;
            border: 1px solid #111;
        }

        #layer-select {
            width: 240px;
            height: 30px;
        }

        .map-overlay1 {
            position: absolute;
            bottom: 0;
            right: 0;
            margin-right: 10px;
            border-radius: 5px;
        }

        #Rightlegend {
            background-size: 100% 100%;
            background-color: rgba(240, 248, 255, 0.8);
            opacity: 1;
            padding: 10px 20px 30px 20px;
            margin-bottom: 40px;
            line-height: 20px;
            min-height: 140px;
            /* width: 140px; */
        }

        #Rightlegend h3 {
            color: rgb(0, 0, 0);
        }

        #Rightlegend span {
            color: rgb(0, 0, 0);
        }

        /* #year-select {
            width: 86px;
        }

        #layer-select2 {
            width: 240px;
        }

        #year-select2 {
            width: 86px;
        } */
    </style>
</head>

<body>
    <div id='map-left' style="left:0; width:50%;"></div>
    <div id='map-right' style="left:50%; width:50%;"></div>
    <div class="draggable-bar"></div>
    <div class='map-overlay top'>
        <div class='map-overlay-inner'>
            <div class="'buttons">
                <button id="navigateButton">Back to main map</button>
            </div>
            <div class="controls">
                <div class="clearfix">
                    <select id="layer-select">
                        <option value="mental-2xzr5u" style="color:black;">mental</option>
                        <option value="LQ-3a6h5i" style="color:black;">lq</option>
                        <option value="dep3-8zbmzs" style="color:black;">dep3</option>
                        <option value="dep4-28q6zo" style="color:black;">dep4</option>
                        <option value="mode-6ka47b" style="color:black;">mode</option>
                        <option value="Obesity-6ukcyy" style="color:black;">Obesity</option>
                        <option value="Cancer-bcqas9" style="color:black;">cancer</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div class='map-overlay2' id='legend'></div>
    <div class='map-overlay1' id='Rightlegend'></div>

    <script>
        mapboxgl.accessToken =
            'pk.eyJ1IjoiZnJleWF3YW5nMTIzIiwiYSI6ImNsZDFtZXNmbDAwM2Uzdm4zOGdyZGk4MWUifQ.KhKFJj1Jow68AzjZNSiUrg';
        const mapLeft = new mapboxgl.Map({
            container: 'map-left',
            style: 'mapbox://styles/freyawang123/clkqxulul00eh01pedce4gzk9',
            center: [-0.160078, 51.52],
            zoom: 12,
            pitch: 50
        });

        const mapRight = new mapboxgl.Map({
            container: 'map-right',
            style: 'mapbox://styles/freyawang123/clkqxulul00eh01pedce4gzk9',
            center: [-0.160078, 51.52],
            zoom: 12,
            pitch: 50
        });

        // Set up the draggable bar
        var isDragging = false;
        var draggableBar = document.querySelector('.draggable-bar');
        draggableBar.addEventListener('mousedown', function (e) {
            e.preventDefault();
            isDragging = true;
        });
        document.addEventListener('mousemove', function (e) {
            if (!isDragging) return;
            var mapWidth = window.innerWidth;
            var newWidth = e.clientX / mapWidth * 100;
            document.getElementById('map-left').style.width = newWidth + '%';
            document.getElementById('map-right').style.left = newWidth + '%';
            document.getElementById('map-right').style.width = (100 - newWidth) + '%';
            draggableBar.style.left = newWidth + '%';
            mapLeft.resize();
            mapRight.resize();
        });

        document.addEventListener('mouseup', function () {
            isDragging = false;
        });

        // Function to load the layers
        function loadLayers(otype, mapInstance) {
            mapInstance.on('load', function () {
                // Set global light properties which influence 3D layer shadows
                mapInstance.setLight({
                    color: "#fff",
                    intensity: 0.15,
                    position: [1.15, 210, 30]
                });
                // Add standard navigation control
                mapInstance.addControl(new mapboxgl.NavigationControl());


                const mentalaccLegendValues = [{
                        value: "<=0.0004088287",
                        color1: '#E1E7F1',
                        color2: '#E6EBE6'
                    },
                    {
                        value: ">0.0004088287",
                        color1: '#D5D7FC',
                        color2: '#E0F4E9'
                    },
                    {
                        value: ">0.0011848689",
                        color1: '#B8B9EF',
                        color2: '#CAE2D2'
                    },
                    {
                        value: ">0.0019609091",
                        color1: '#999FE1',
                        color2: '#B1D0BD'
                    },
                    {
                        value: ">0.0028189599",
                        color1: '#7D85D4',
                        color2: '#9EC0A5'
                    },
                    {
                        value: ">0.0034346511",
                        color1: '#6577CA',
                        color2: '#89AD8D'
                    },
                    {
                        value: ">0.0039879163",
                        color1: '#4D66BC',
                        color2: '#799D7C'
                    },
                    {
                        value: ">0.0049904035",
                        color1: '#3857AD',
                        color2: '#658F67'
                    },
                    {
                        value: ">0.0062474907",
                        color1: '#294DA3',
                        color2: '#528054'
                    },
                    {
                        value: ">0.0077665221",
                        color1: '#1D4499',
                        color2: '#417049'
                    },
                    {
                        value: ">0.0095780985",
                        color1: '#113A8F',
                        color2: '#38623A'
                    },
                ];

                const mentalDensityLegendValues = [{
                        value: "<=0.0001077154",
                        color: '#E6EBE6'
                    },
                    {
                        value: ">0.0001077154",
                        color: '#E0F4E9'
                    },
                    {
                        value: ">0.0001493327",
                        color: '#CAE2D2'
                    },
                    {
                        value: ">0.0002105346",
                        color: '#B1D0BD'
                    },
                    {
                        value: ">0.0002558240",
                        color: '#9EC0A5'
                    },
                    {
                        value: ">0.0003182499",
                        color: '#89AD8D'
                    },
                    {
                        value: ">0.0003696595",
                        color: '#799D7C'
                    },
                    {
                        value: ">0.0004088287",
                        color: '#658F67'
                    },
                    {
                        value: ">0.0004431018",
                        color: '#528054'
                    },
                    {
                        value: ">0.0005165441",
                        color: '#417049'
                    },
                    {
                        value: ">0.0006328277",
                        color: '#38623A'
                    },
                ];

                const CanceraccLegendValues = [{
                        value: "<=5.385768e-05",
                        color1: '#E1E7F1',
                        color2: '#E6EBE6'
                    },
                    {
                        value: ">5.385768e-05",
                        color1: '#D5D7FC',
                        color2: '#E0F4E9'
                    },
                    {
                        value: ">4.112768e-04",
                        color1: '#B8B9EF',
                        color2: '#CAE2D2'
                    },
                    {
                        value: ">6.609806e-04",
                        color1: '#999FE1',
                        color2: '#B1D0BD'
                    },
                    {
                        value: ">9.792305e-04",
                        color1: '#7D85D4',
                        color2: '#9EC0A5'
                    },
                    {
                        value: ">1.238727e-03",
                        color1: '#6577CA',
                        color2: '#89AD8D'
                    },
                    {
                        value: ">1.586353e-03",
                        color1: '#4D66BC',
                        color2: '#799D7C'
                    },
                    {
                        value: ">2.056384e-03",
                        color1: '#3857AD',
                        color2: '#658F67'
                    },
                    {
                        value: ">2.878938e-03",
                        color1: '#294DA3',
                        color2: '#528054'
                    },
                    {
                        value: ">3.554607e-03",
                        color1: '#1D4499',
                        color2: '#417049'
                    },
                    {
                        value: ">5.728499e-03",
                        color1: '#113A8F',
                        color2: '#38623A'
                    },
                ];

                const CancerDensityLegendValues = [{
                        value: "<=3.916922e-05",
                        color: '#E6EBE6'
                    },
                    {
                        value: ">3.916922e-05",
                        color: '#E0F4E9'
                    },
                    {
                        value: ">4.896153e-05",
                        color: '#CAE2D2'
                    },
                    {
                        value: ">6.364998e-05",
                        color: '#B1D0BD'
                    },
                    {
                        value: ">7.833844e-05",
                        color: '#9EC0A5'
                    },
                    {
                        value: ">8.813075e-05",
                        color: '#89AD8D'
                    },
                    {
                        value: ">9.792305e-05",
                        color: '#799D7C'
                    },
                    {
                        value: ">1.175077e-04",
                        color: '#658F67'
                    },
                    {
                        value: ">1.370923e-04",
                        color: '#528054'
                    },
                    {
                        value: ">1.664692e-04",
                        color: '#417049'
                    },
                    {
                        value: ">2.056384e-04",
                        color: '#38623A'
                    },
                ];

                const ObesityaccLegendValues = [{
                        value: "<=0.0003378345",
                        color1: '#E1E7F1',
                        color2: '#E6EBE6'
                    },
                    {
                        value: ">0.0003378345",
                        color1: '#D5D7FC',
                        color2: '#E0F4E9'
                    },
                    {
                        value: ">0.0008323459",
                        color1: '#B8B9EF',
                        color2: '#CAE2D2'
                    },
                    {
                        value: ">0.0013023766",
                        color1: '#999FE1',
                        color2: '#B1D0BD'
                    },
                    {
                        value: ">0.0018458495",
                        color1: '#7D85D4',
                        color2: '#9EC0A5'
                    },
                    {
                        value: ">0.0024089071",
                        color1: '#6577CA',
                        color2: '#89AD8D'
                    },
                    {
                        value: ">0.0030551992",
                        color1: '#4D66BC',
                        color2: '#799D7C'
                    },
                    {
                        value: ">0.0036721145",
                        color1: '#3857AD',
                        color2: '#658F67'
                    },
                    {
                        value: ">0.0046268642",
                        color1: '#294DA3',
                        color2: '#528054'
                    },
                    {
                        value: ">0.0064776099",
                        color1: '#1D4499',
                        color2: '#417049'
                    },
                    {
                        value: ">0.0085927478",
                        color1: '#113A8F',
                        color2: '#38623A'
                    },
                ];

                const ObesityDensityLegendValues = [{
                        value: "<=7.833844e-05",
                        color: '#E6EBE6'
                    },
                    {
                        value: ">7.833844e-05",
                        color: '#E0F4E9'
                    },
                    {
                        value: ">1.175077e-04",
                        color: '#CAE2D2'
                    },
                    {
                        value: ">1.468846e-04",
                        color: '#B1D0BD'
                    },
                    {
                        value: ">1.958461e-04",
                        color: '#9EC0A5'
                    },
                    {
                        value: ">2.497038e-04",
                        color: '#89AD8D'
                    },
                    {
                        value: ">2.986653e-04",
                        color: '#799D7C'
                    },
                    {
                        value: ">3.280422e-04",
                        color: '#658F67'
                    },
                    {
                        value: ">3.672114e-04",
                        color: '#528054'
                    },
                    {
                        value: ">4.259653e-04",
                        color: '#417049'
                    },
                    {
                        value: ">4.994076e-04",
                        color: '#38623A'
                    },
                ];

                const ModeaccLegendValues = [{
                        value: "<=0.004764426",
                        color1: '#E1E7F1',
                        color2: '#E6EBE6'
                    },
                    {
                        value: ">0.004764426",
                        color1: '#D5D7FC',
                        color2: '#E0F4E9'
                    },
                    {
                        value: ">0.029115934",
                        color1: '#B8B9EF',
                        color2: '#CAE2D2'
                    },
                    {
                        value: ">0.055584966",
                        color1: '#999FE1',
                        color2: '#B1D0BD'
                    },
                    {
                        value: ">0.080995236",
                        color1: '#7D85D4',
                        color2: '#9EC0A5'
                    },
                    {
                        value: ">0.103229222",
                        color1: '#6577CA',
                        color2: '#89AD8D'
                    },
                    {
                        value: ">0.125992589",
                        color1: '#4D66BC',
                        color2: '#799D7C'
                    },
                    {
                        value: ">0.161990471",
                        color1: '#3857AD',
                        color2: '#658F67'
                    },
                    {
                        value: ">0.206987824",
                        color1: '#294DA3',
                        color2: '#528054'
                    },
                    {
                        value: ">0.296982530",
                        color1: '#1D4499',
                        color2: '#417049'
                    },
                    {
                        value: ">0.395976707",
                        color1: '#113A8F',
                        color2: '#38623A'
                    },
                ];

                const ModeDensityLegendValues = [{
                        value: "<=0.002073407",
                        color: '#CAE2D2'
                    },
                    {
                        value: ">0.002073407",
                        color: '#B1D0BD'
                    },
                    {
                        value: ">0.004235045",
                        color: '#9EC0A5'
                    },
                    {
                        value: ">0.005293806",
                        color: '#89AD8D'
                    },
                    {
                        value: ">0.006881948",
                        color: '#799D7C'
                    },
                    {
                        value: ">0.008470090",
                        color: '#658F67'
                    },
                    {
                        value: ">0.010058232",
                        color: '#528054'
                    },
                    {
                        value: ">0.017204870",
                        color: '#417049'
                    },
                    {
                        value: ">0.024925004",
                        color: '#38623A'
                    },
                ];

                const Dep3accLegendValues = [{
                        value: "<=0.0003375599",
                        color1: '#E1E7F1',
                        color2: '#E6EBE6'
                    },
                    {
                        value: ">0.0003375599",
                        color1: '#D5D7FC',
                        color2: '#E0F4E9'
                    },
                    {
                        value: ">0.0011181670",
                        color1: '#B8B9EF',
                        color2: '#CAE2D2'
                    },
                    {
                        value: ">0.0022152366",
                        color1: '#999FE1',
                        color2: '#B1D0BD'
                    },
                    {
                        value: ">0.0033228549",
                        color1: '#7D85D4',
                        color2: '#9EC0A5'
                    },
                    {
                        value: ">0.0043671807",
                        color1: '#6577CA',
                        color2: '#89AD8D'
                    },
                    {
                        value: ">0.0063292475",
                        color1: '#4D66BC',
                        color2: '#799D7C'
                    },
                    {
                        value: ">0.0085444841",
                        color1: '#3857AD',
                        color2: '#658F67'
                    },
                    {
                        value: ">0.0132281272",
                        color1: '#294DA3',
                        color2: '#528054'
                    },
                    {
                        value: ">0.0163505559",
                        color1: '#1D4499',
                        color2: '#417049'
                    },
                    {
                        value: ">0.0174687230",
                        color1: '#113A8F',
                        color2: '#38623A'
                    },
                ];

                const Dep3DensityLegendValues = [{
                        value: "<=2.109749e-05",
                        color: '#E6EBE6'
                    },
                    {
                        value: ">2.109749e-05",
                        color: '#E0F4E9'
                    },
                    {
                        value: ">1.265849e-04",
                        color: '#CAE2D2'
                    },
                    {
                        value: ">2.637186e-04",
                        color: '#B1D0BD'
                    },
                    {
                        value: ">3.903036e-04",
                        color: '#9EC0A5'
                    },
                    {
                        value: ">5.168885e-04",
                        color: '#89AD8D'
                    },
                    {
                        value: ">6.751197e-04",
                        color: '#799D7C'
                    },
                    {
                        value: ">8.017047e-04",
                        color: '#658F67'
                    },
                    {
                        value: ">9.810334e-04",
                        color: '#528054'
                    },
                    {
                        value: ">1.318593e-03",
                        color: '#417049'
                    },
                    {
                        value: ">1.803836e-03",
                        color: '#38623A'
                    },
                ];

                const Dep4accLegendValues = [{
                        value: "<=6.329247e-05",
                        color1: '#D5D7FC',
                        color2: '#E0F4E9'
                    },
                    {
                        value: ">6.329247e-05",
                        color1: '#B8B9EF',
                        color2: '#CAE2D2'
                    },
                    {
                        value: ">2.215237e-04",
                        color1: '#999FE1',
                        color2: '#B1D0BD'
                    },
                    {
                        value: ">4.114011e-04",
                        color1: '#7D85D4',
                        color2: '#9EC0A5'
                    },
                    {
                        value: ">6.645710e-04",
                        color1: '#6577CA',
                        color2: '#89AD8D'
                    },
                    {
                        value: ">9.493871e-04",
                        color1: '#4D66BC',
                        color2: '#799D7C'
                    },
                    {
                        value: ">1.234203e-03",
                        color1: '#3857AD',
                        color2: '#658F67'
                    },
                    {
                        value: ">1.582312e-03",
                        color1: '#294DA3',
                        color2: '#528054'
                    },
                    {
                        value: ">1.962067e-03",
                        color1: '#1D4499',
                        color2: '#417049'
                    },
                    {
                        value: ">2.563345e-03",
                        color1: '#113A8F',
                        color2: '#38623A'
                    },
                ];

                const Dep4DensityLegendValues = [{
                        value: "<=1.054875e-05",
                        color: '#E0F4E9'
                    },
                    {
                        value: ">1.054875e-05",
                        color: '#CAE2D2'
                    },
                    {
                        value: ">3.164624e-05",
                        color: '#B1D0BD'
                    },
                    {
                        value: ">5.274373e-05",
                        color: '#9EC0A5'
                    },
                    {
                        value: ">7.384122e-05",
                        color: '#89AD8D'
                    },
                    {
                        value: ">1.054875e-04",
                        color: '#799D7C'
                    },
                    {
                        value: ">1.265849e-04",
                        color: '#658F67'
                    },
                    {
                        value: ">1.582312e-04",
                        color: '#528054'
                    },
                    {
                        value: ">2.004262e-04",
                        color: '#417049'
                    },
                    {
                        value: ">2.637186e-04",
                        color: '#38623A'
                    },
                ];

                const LQaccLegendValues = [{
                        value: "<=0.004438277",
                        color1: '#E1E7F1',
                        color2: '#E6EBE6'
                    },
                    {
                        value: ">0.004438277",
                        color1: '#D5D7FC',
                        color2: '#E0F4E9'
                    },
                    {
                        value: ">0.030321357",
                        color1: '#B8B9EF',
                        color2: '#CAE2D2'
                    },
                    {
                        value: "> 0.058352553",
                        color1: '#999FE1',
                        color2: '#B1D0BD'
                    },
                    {
                        value: ">0.087571249",
                        color1: '#7D85D4',
                        color2: '#9EC0A5'
                    },
                    {
                        value: ">0.109761906",
                        color1: '#6577CA',
                        color2: '#89AD8D'
                    },
                    {
                        value: ">0.143867070",
                        color1: '#4D66BC',
                        color2: '#799D7C'
                    },
                    {
                        value: ">0.177593853",
                        color1: '#3857AD',
                        color2: '#658F67'
                    },
                    {
                        value: ">0.228579739",
                        color1: '#294DA3',
                        color2: '#528054'
                    },
                    {
                        value: ">0.279538962",
                        color1: '#1D4499',
                        color2: '#417049'
                    },
                    {
                        value: ">0.361405656",
                        color1: '#113A8F',
                        color2: '#38623A'
                    },
                ];

                const LQDensityLegendValues = [{
                        value: "<=0.004036141",
                        color: '#E6EBE6'
                    },
                    {
                        value: ">0.004036141",
                        color: '#E0F4E9'
                    },
                    {
                        value: ">0.004581775",
                        color: '#CAE2D2'
                    },
                    {
                        value: ">0.005173222",
                        color: '#B1D0BD'
                    },
                    {
                        value: ">0.005800787",
                        color: '#9EC0A5'
                    },
                    {
                        value: ">0.006479981",
                        color: '#89AD8D'
                    },
                    {
                        value: ">0.007203049",
                        color: '#799D7C'
                    },
                    {
                        value: ">0.007962962",
                        color: '#658F67'
                    },
                    {
                        value: ">0.008793169",
                        color: '#528054'
                    },
                    {
                        value: ">0.009512359",
                        color: '#417049'
                    },
                    {
                        value: ">0.010329962",
                        color: '#38623A'
                    },
                ];





                initMap(otype, mapInstance)
                updateLegend("mental-2xzr5u");
                showLayer('mental-2xzr5u', otype, mapInstance);



                function updateLegend(attribute) {
                    let legend = document.getElementById('legend');
                    legend.innerHTML = '';
                    let Rightlegend = document.getElementById('Rightlegend');
                    Rightlegend.innerHTML = '';

                    if (attribute === 'mental-2xzr5u') {

                        legend.innerHTML = '<h3>mental_acc</h3>';
                        mentalaccLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color1;

                            let key2 = document.createElement('span');
                            key2.className = 'legend-key';
                            key2.style.backgroundColor = item.color2;

                            let label = document.createElement('span');
                            label.innerHTML = item.value;

                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(key2);
                            legendItem.appendChild(label);

                            legend.appendChild(legendItem);
                        });
                        Rightlegend.innerHTML = '<h3>mental_Density</h3>';
                        mentalDensityLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color;
                            let label = document.createElement('span');
                            label.innerHTML = item.value;
                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(label);

                            Rightlegend.appendChild(legendItem);
                        });

                    }
                    if (attribute === 'LQ-3a6h5i') {
                        legend.innerHTML = '<h3>LQ_acc</h3>';
                        LQaccLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color1;

                            let key2 = document.createElement('span');
                            key2.className = 'legend-key';
                            key2.style.backgroundColor = item.color2;

                            let label = document.createElement('span');
                            label.innerHTML = item.value;

                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(key2);
                            legendItem.appendChild(label);

                            legend.appendChild(legendItem);
                        });
                        Rightlegend.innerHTML = '<h3>LQ_Density</h3>';
                        LQDensityLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color;
                            let label = document.createElement('span');
                            label.innerHTML = item.value;
                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(label);

                            Rightlegend.appendChild(legendItem);
                        });
                    }
                    if (attribute === 'dep3-8zbmzs') {
                        legend.innerHTML = '<h3>Dep3_acc</h3>';
                        Dep3accLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color1;

                            let key2 = document.createElement('span');
                            key2.className = 'legend-key';
                            key2.style.backgroundColor = item.color2;

                            let label = document.createElement('span');
                            label.innerHTML = item.value;

                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(key2);
                            legendItem.appendChild(label);

                            legend.appendChild(legendItem);
                        });
                        Rightlegend.innerHTML = '<h3>Dep3_Density</h3>';
                        Dep3DensityLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color;
                            let label = document.createElement('span');
                            label.innerHTML = item.value;
                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(label);

                            Rightlegend.appendChild(legendItem);
                        });
                    }
                    if (attribute === 'dep4-28q6zo') {
                        legend.innerHTML = '<h3>Dep4_acc</h3>';
                        Dep4accLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color1;

                            let key2 = document.createElement('span');
                            key2.className = 'legend-key';
                            key2.style.backgroundColor = item.color2;

                            let label = document.createElement('span');
                            label.innerHTML = item.value;

                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(key2);
                            legendItem.appendChild(label);

                            legend.appendChild(legendItem);
                        });
                        Rightlegend.innerHTML = '<h3>Dep4_Density</h3>';
                        Dep4DensityLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color;
                            let label = document.createElement('span');
                            label.innerHTML = item.value;
                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(label);

                            Rightlegend.appendChild(legendItem);
                        });
                    }
                    if (attribute === 'mode-6ka47b') {
                        legend.innerHTML = '<h3>Mode_acc</h3>';
                        ModeaccLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color1;

                            let key2 = document.createElement('span');
                            key2.className = 'legend-key';
                            key2.style.backgroundColor = item.color2;

                            let label = document.createElement('span');
                            label.innerHTML = item.value;

                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(key2);
                            legendItem.appendChild(label);

                            legend.appendChild(legendItem);
                        });
                        Rightlegend.innerHTML = '<h3>Mode_Density</h3>';
                        ModeDensityLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color;
                            let label = document.createElement('span');
                            label.innerHTML = item.value;
                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(label);

                            Rightlegend.appendChild(legendItem);
                        });
                    }
                    if (attribute === 'Obesity-6ukcyy') {
                        legend.innerHTML = '<h3>Obesity_acc</h3>';
                        ObesityaccLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color1;

                            let key2 = document.createElement('span');
                            key2.className = 'legend-key';
                            key2.style.backgroundColor = item.color2;

                            let label = document.createElement('span');
                            label.innerHTML = item.value;

                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(key2);
                            legendItem.appendChild(label);

                            legend.appendChild(legendItem);
                        });
                        Rightlegend.innerHTML = '<h3>Obesity_Density</h3>';
                        ObesityDensityLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color;
                            let label = document.createElement('span');
                            label.innerHTML = item.value;
                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(label);

                            Rightlegend.appendChild(legendItem);
                        });
                    }
                    if (attribute === 'Cancer-bcqas9') {
                        legend.innerHTML = '<h3>Cancer_acc</h3>';
                        CanceraccLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color1;

                            let key2 = document.createElement('span');
                            key2.className = 'legend-key';
                            key2.style.backgroundColor = item.color2;

                            let label = document.createElement('span');
                            label.innerHTML = item.value;

                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(key2);
                            legendItem.appendChild(label);

                            legend.appendChild(legendItem);
                        });
                        Rightlegend.innerHTML = '<h3>Cancer_Density</h3>';
                        CancerDensityLegendValues.forEach((item) => {
                            let key1 = document.createElement('span');
                            key1.className = 'legend-key';
                            key1.style.backgroundColor = item.color;
                            let label = document.createElement('span');
                            label.innerHTML = item.value;
                            let legendItem = document.createElement('div');
                            legendItem.appendChild(key1);
                            legendItem.appendChild(label);

                            Rightlegend.appendChild(legendItem);
                        });
                    }
                }

                function initMap(otype, mapInstance) {
                   
                    showmental(otype, mapInstance);
                    showLQ(otype, mapInstance);
                    showdep3(otype, mapInstance);
                    showdep4(otype, mapInstance);
                    showmode(otype, mapInstance);
                    showObesity(otype, mapInstance);
                    showCancer(otype, mapInstance);
                    showhousing(otype, mapInstance);
                }

                function showhousing(otype, mapInstance) {
                    if (otype == "Left") {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'housing_shp-89k0ag-' + otype,
                            type: 'circle',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.ap8rzea0' // Mapbox tileset Map ID
                            },
                            'source-layer': 'housing_shp-89k0ag', // name of tilesets
                           
                            paint: {
                                "circle-color": "hsl(0, 73%, 47%)",
                                "circle-opacity": 1
                            }
                            // 'filter': ['<=', ['/', ['get', 'mental_acc'],
                            //             ['get', 'density_mental4']
                            //         ], 15]
                        });
                    } else {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'housing_shp-89k0ag-' + otype,
                            type: 'circle',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.ap8rzea0' // Mapbox tileset Map ID
                            },
                            'source-layer': 'housing_shp-89k0ag', // name of tilesets
                            
                            paint: {
                                "circle-color": "hsl(0, 73%, 47%)",
                                "circle-opacity": 1
                            }
                        });
                    }
                }

                function showmental(otype, mapInstance) {
                    if (otype == "Left") {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'mental-2xzr5u-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.3a47obxw' // Mapbox tileset Map ID
                            },
                            'source-layer': 'mental-2xzr5u', // name of tilesets 
                            'layout': {
                                'visibility': 'none'
                            },
                            paint: {
                                'fill-color': [
                                    'step',
                                    ['/', ['get', 'mental_acc'],
                                        ['get', 'density_mental4']
                                    ],
                                    ['step', ['get', 'mental_acc'],
                                        '#E1E7F1',
                                        0.0004088287, '#D5D7FC',
                                        0.0011848689, '#B8B9EF',
                                        0.0019609091, '#999FE1',
                                        0.0028189599, '#7D85D4',
                                        0.0034346511, '#6577CA',
                                        0.0039879163, '#4D66BC',
                                        0.0049904035, '#3857AD',
                                        0.0062474907, '#294DA3',
                                        0.0077665221, '#1D4499',
                                        0.0095780985, '#113A8F'
                                    ],
                                    15,
                                    ['step', ['get', 'mental_acc'],
                                        '#E6EBE6',
                                        0.0004088287, '#E0F4E9',
                                        0.0011848689, '#CAE2D2',
                                        0.0019609091, '#B1D0BD',
                                        0.0028189599, '#9EC0A5',
                                        0.0034346511, '#89AD8D',
                                        0.0039879163, '#799D7C',
                                        0.0049904035, '#658F67',
                                        0.0062474907, '#528054',
                                        0.0077665221, '#417049',
                                        0.0095780985, '#38623A'
                                    ],
                                    // 750,
                                    // '#f28cb1'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7
                            },
                            // 'filter': ['<=', ['/', ['get', 'mental_acc'],
                            //             ['get', 'density_mental4']
                            //         ], 15]
                        });
                    } else {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'mental-2xzr5u-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.3a47obxw' // Mapbox tileset Map ID
                            },
                            'source-layer': 'mental-2xzr5u', // name of tilesets
                            'layout': {
                                'visibility': 'none'
                            },
                            paint: {
                                "fill-color": [
                                    'step', ['get', 'density_mental4'],
                                    '#E6EBE6',
                                    0.0001077154, '#E0F4E9',
                                    0.0001493327, '#CAE2D2',
                                    0.0002105346, '#B1D0BD',
                                    0.0002558240, '#9EC0A5',
                                    0.0003182499, '#89AD8D',
                                    0.0003696595, '#799D7C',
                                    0.0004088287, '#658F67',
                                    0.0004431018, '#528054',
                                    0.0005165441, '#417049',
                                    0.0006328277, '#38623A'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7
                            }
                        });
                    }
                }

                function showLQ(otype, mapInstance) {
                    if (otype == "Left") {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'LQ-3a6h5i-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.9ijnes36' // Mapbox tileset Map ID
                            },
                            'source-layer': 'LQ-3a6h5i', // name of tilesets  
                            'layout': {
                                'visibility': 'none'
                            },
                            paint: {
                                'fill-color': [
                                    'step',
                                    ['/', ['get', 'LQ_acc'],
                                        ['get', 'density_LQ']
                                    ],
                                    ['step', ['get', 'LQ_acc'],
                                        '#E1E7F1',
                                        0.004438277, '#D5D7FC',
                                        0.030321357, '#B8B9EF',
                                        0.058352553, '#999FE1',
                                        0.087571249, '#7D85D4',
                                        0.109761906, '#6577CA',
                                        0.143867070, '#4D66BC',
                                        0.177593853, '#3857AD',
                                        0.228579739, '#294DA3',
                                        0.279538962, '#1D4499',
                                        0.361405656, '#113A8F'
                                    ],
                                    15,
                                    ['step', ['get', 'LQ_acc'],
                                        '#E6EBE6',
                                        0.004438277, '#E0F4E9',
                                        0.030321357, '#CAE2D2',
                                        0.058352553, '#B1D0BD',
                                        0.087571249, '#9EC0A5',
                                        0.109761906, '#89AD8D',
                                        0.143867070, '#799D7C',
                                        0.177593853, '#658F67',
                                        0.228579739, '#528054',
                                        0.279538962, '#417049',
                                        0.361405656, '#38623A'
                                    ],
                                    // 750,
                                    // '#f28cb1'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7


                            }
                        });
                    } else {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'LQ-3a6h5i-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.9ijnes36' // Mapbox tileset Map ID
                            },
                            'source-layer': 'LQ-3a6h5i', // name of tilesets
                            'layout': {
                                'visibility': 'none'
                            },
                            paint: {
                                "fill-color": [
                                    'step', ['get', 'density_LQ'],
                                    '#E6EBE6',
                                    0.004036141, '#E0F4E9',
                                    0.004581775, '#CAE2D2',
                                    0.005173222, '#B1D0BD',
                                    0.005800787, '#9EC0A5',
                                    0.006479981, '#89AD8D',
                                    0.007203049, '#799D7C',
                                    0.007962962, '#658F67',
                                    0.008793169, '#528054',
                                    0.009512359, '#417049',
                                    0.010329962, '#38623A'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7
                            }
                        });

                    }

                }

                function showdep3(otype, mapInstance) {
                    if (otype == "Left") {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'dep3-8zbmzs-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.7voioag3' // Mapbox tileset Map ID
                            },
                            'source-layer': 'dep3-8zbmzs', // name of tilesets  
                            'layout': {
                                'visibility': 'none'
                            },
                            paint: {
                                'fill-color': [
                                    'step',
                                    ['/', ['get', 'acc_3'],
                                        ['get', 'density3']
                                    ],
                                    ['step', ['get', 'acc_3'],
                                        '#E1E7F1',
                                        0.0003375599, '#D5D7FC',
                                        0.0011181670, '#B8B9EF',
                                        0.0022152366, '#999FE1',
                                        0.0033228549, '#7D85D4',
                                        0.0043671807, '#6577CA',
                                        0.0063292475, '#4D66BC',
                                        0.0085444841, '#3857AD',
                                        0.0132281272, '#294DA3',
                                        0.0163505559, '#1D4499',
                                        0.0174687230, '#113A8F'
                                    ],
                                    15,
                                    ['step', ['get', 'acc_3'],
                                        '#E6EBE6',
                                        0.0003375599, '#E0F4E9',
                                        0.0011181670, '#CAE2D2',
                                        0.0022152366, '#B1D0BD',
                                        0.0033228549, '#9EC0A5',
                                        0.0043671807, '#89AD8D',
                                        0.0063292475, '#799D7C',
                                        0.0085444841, '#658F67',
                                        0.0132281272, '#528054',
                                        0.0163505559, '#417049',
                                        0.0174687230, '#38623A'
                                    ],
                                    // 750,
                                    // '#f28cb1'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7


                            }
                        });
                    } else {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'dep3-8zbmzs-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.7voioag3' // Mapbox tileset Map ID
                            },
                            'source-layer': 'dep3-8zbmzs', // name of tilesets
                            'layout': {
                                'visibility': 'none'
                            },
                            paint: {
                                "fill-color": [
                                    'step', ['get', 'density3'],
                                    '#E6EBE6',
                                    2.109749e-05, '#E0F4E9',
                                    1.265849e-04, '#CAE2D2',
                                    2.637186e-04, '#B1D0BD',
                                    3.903036e-04, '#9EC0A5',
                                    5.168885e-04, '#89AD8D',
                                    6.751197e-04, '#799D7C',
                                    8.017047e-04, '#658F67',
                                    9.810334e-04, '#528054',
                                    1.318593e-03, '#417049',
                                    1.803836e-03, '#38623A'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7
                            }
                        });
                    }

                }

                function showdep4(otype, mapInstance) {
                    if (otype == "Left") {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'dep4-28q6zo-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.1ka07ku2' // Mapbox tileset Map ID
                            },
                            'source-layer': 'dep4-28q6zo', // name of tilesets  
                            'layout': {
                                'visibility': 'none'
                            },
                            paint: {
                                'fill-color': [
                                    'step',
                                    ['/', ['get', 'acc_4'],
                                        ['get', 'density4']
                                    ],
                                    ['step', ['get', 'acc_4'],
                                        '#D5D7FC',
                                        6.329247e-05, '#B8B9EF',
                                        2.215237e-04, '#999FE1',
                                        4.114011e-04, '#7D85D4',
                                        6.645710e-04, '#6577CA',
                                        9.493871e-04, '#4D66BC',
                                        1.234203e-03, '#3857AD',
                                        1.582312e-03, '#294DA3',
                                        1.962067e-03, '#1D4499',
                                        2.563345e-03, '#113A8F'
                                    ],
                                    15,
                                    ['step', ['get', 'acc_4'],
                                        '#E0F4E9',
                                        6.329247e-05, '#CAE2D2',
                                        2.215237e-04, '#B1D0BD',
                                        4.114011e-04, '#9EC0A5',
                                        6.645710e-04, '#89AD8D',
                                        9.493871e-04, '#799D7C',
                                        1.234203e-03, '#658F67',
                                        1.582312e-03, '#528054',
                                        1.962067e-03, '#417049',
                                        2.563345e-03, '#38623A'
                                    ],
                                    // 750,
                                    // '#f28cb1'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7
                            }
                        });
                    } else {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'dep4-28q6zo-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.1ka07ku2' // Mapbox tileset Map ID
                            },
                            'source-layer': 'dep4-28q6zo', // name of tilesets
                            'layout': {
                                'visibility': 'none'
                            },
                            paint: {
                                "fill-color": [
                                    'step', ['get', 'density4'],
                                    '#E0F4E9',
                                    1.054875e-05, '#CAE2D2',
                                    3.164624e-05, '#B1D0BD',
                                    5.274373e-05, '#9EC0A5',
                                    7.384122e-05, '#89AD8D',
                                    1.054875e-04, '#799D7C',
                                    1.265849e-04, '#658F67',
                                    1.582312e-04, '#528054',
                                    2.004262e-04, '#417049',
                                    2.637186e-04, '#38623A'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7
                            }
                        });
                    }

                }

                function showmode(otype, mapInstance) {
                    if (otype == "Left") {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'mode-6ka47b-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.93tszbhb' // Mapbox tileset Map ID
                            },
                            'source-layer': 'mode-6ka47b', // name of tilesets  
                            'layout': {
                                'visibility': 'none'
                            },
                            paint: {
                                'fill-color': [
                                    'step',
                                    ['/', ['get', 'mode_acc'],
                                        ['get', 'density_mode']
                                    ],
                                    ['step', ['get', 'mode_acc'],
                                        '#E1E7F1',
                                        0.004764426, '#D5D7FC',
                                        0.029115934, '#B8B9EF',
                                        0.055584966, '#999FE1',
                                        0.080995236, '#7D85D4',
                                        0.103229222, '#6577CA',
                                        0.125992589, '#4D66BC',
                                        0.161990471, '#3857AD',
                                        0.206987824, '#294DA3',
                                        0.296982530, '#1D4499',
                                        0.395976707, '#113A8F'
                                    ],
                                    15,
                                    ['step', ['get', 'mode_acc'],
                                        '#E6EBE6',
                                        0.004764426, '#E0F4E9',
                                        0.029115934, '#CAE2D2',
                                        0.055584966, '#B1D0BD',
                                        0.080995236, '#9EC0A5',
                                        0.103229222, '#89AD8D',
                                        0.125992589, '#799D7C',
                                        0.161990471, '#658F67',
                                        0.206987824, '#528054',
                                        0.296982530, '#417049',
                                        0.395976707, '#38623A'
                                    ],
                                    // 750,
                                    // '#f28cb1'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7


                            }
                        });
                    } else {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'mode-6ka47b-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.93tszbhb' // Mapbox tileset Map ID
                            },
                            'source-layer': 'mode-6ka47b', // name of tilesets
                            'layout': {
                                'visibility': 'none'
                            },
                            paint: {
                                "fill-color": [
                                    'step', ['get', 'density_mode'],
                                    '#CAE2D2',
                                    0.002073407, '#B1D0BD',
                                    0.004235045, '#9EC0A5',
                                    0.005293806, '#89AD8D',
                                    0.006881948, '#799D7C',
                                    0.008470090, '#658F67',
                                    0.010058232, '#528054',
                                    0.017204870, '#417049',
                                    0.024925004, '#38623A'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7
                            }
                        });
                    }

                }

                function showObesity(otype, mapInstance) {
                    if (otype == "Left") {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'Obesity-6ukcyy-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.0hs0lwyo' // Mapbox tileset Map ID
                            },
                            'source-layer': 'Obesity-6ukcyy', // name of tilesets  
                            'layout': {
                                'visibility': 'none'
                            },
                            paint: {
                                'fill-color': [
                                    'step',
                                    ['/', ['get', 'obesity_acc'],
                                        ['get', 'obesity_density']
                                    ],
                                    ['step', ['get', 'obesity_acc'],
                                        '#E1E7F1',
                                        0.0003378345, '#D5D7FC',
                                        0.0008323459, '#B8B9EF',
                                        0.0013023766, '#999FE1',
                                        0.0018458495, '#7D85D4',
                                        0.0024089071, '#6577CA',
                                        0.0030551992, '#4D66BC',
                                        0.0036721145, '#3857AD',
                                        0.0046268642, '#294DA3',
                                        0.0064776099, '#1D4499',
                                        0.0085927478, '#113A8F'
                                    ],
                                    15,
                                    ['step', ['get', 'obesity_acc'],
                                        '#E6EBE6',
                                        0.0003378345, '#E0F4E9',
                                        0.0008323459, '#CAE2D2',
                                        0.0013023766, '#B1D0BD',
                                        0.0018458495, '#9EC0A5',
                                        0.0024089071, '#89AD8D',
                                        0.0030551992, '#799D7C',
                                        0.0036721145, '#658F67',
                                        0.0046268642, '#528054',
                                        0.0064776099, '#417049',
                                        0.0085927478, '#38623A'
                                    ],
                                    // 750,
                                    // '#f28cb1'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7


                            }
                        });
                    } else {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'Obesity-6ukcyy-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.0hs0lwyo' // Mapbox tileset Map ID
                            },
                            'source-layer': 'Obesity-6ukcyy', // name of tilesets
                            'layout': {
                                'visibility': 'none'
                            },
                            paint: {
                                "fill-color": [
                                    'step', ['get', 'obesity_density'],
                                    '#E6EBE6',
                                    7.833844e-05, '#E0F4E9',
                                    1.175077e-04, '#CAE2D2',
                                    1.468846e-04, '#B1D0BD',
                                    1.958461e-04, '#9EC0A5',
                                    2.497038e-04, '#89AD8D',
                                    2.986653e-04, '#799D7C',
                                    3.280422e-04, '#658F67',
                                    3.672114e-04, '#528054',
                                    4.259653e-04, '#417049',
                                    4.994076e-04, '#38623A'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7
                            }
                        });
                    }

                }

                function showCancer(otype, mapInstance) {
                    if (otype == "Left") {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'Cancer-bcqas9-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.6ghn1sl4' // Mapbox tileset Map ID
                            },
                            'source-layer': 'Cancer-bcqas9', // name of tilesets  
                            paint: {
                                'fill-color': [
                                    'step',
                                    ['/', ['get', 'cancer_acc'],
                                        ['get', 'cancer_density']
                                    ],
                                    ['step', ['get', 'cancer_acc'],
                                        '#E1E7F1',
                                        5.385768e-05, '#D5D7FC',
                                        4.112768e-04, '#B8B9EF',
                                        6.609806e-04, '#999FE1',
                                        9.792305e-04, '#7D85D4',
                                        1.238727e-03, '#6577CA',
                                        1.586353e-03, '#4D66BC',
                                        2.056384e-03, '#3857AD',
                                        2.878938e-03, '#294DA3',
                                        3.554607e-03, '#1D4499',
                                        5.728499e-03, '#113A8F'
                                    ],
                                    15,
                                    ['step', ['get', 'cancer_acc'],
                                        '#E6EBE6',
                                        5.385768e-05, '#E0F4E9',
                                        4.112768e-04, '#CAE2D2',
                                        6.609806e-04, '#B1D0BD',
                                        9.792305e-04, '#9EC0A5',
                                        1.238727e-03, '#89AD8D',
                                        1.586353e-03, '#799D7C',
                                        2.056384e-03, '#658F67',
                                        2.878938e-03, '#528054',
                                        3.554607e-03, '#417049',
                                        5.728499e-03, '#38623A'
                                    ],
                                    // 750,
                                    // '#f28cb1'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7


                            }
                        });
                    } else {
                        mapInstance.addLayer({ //Add the fill layer. It is not visible (opacity 0) and is used only as the basis of the hover selection
                            id: 'Cancer-bcqas9-' + otype,
                            type: 'fill',
                            source: {
                                type: 'vector',
                                url: 'mapbox://freyawang123.6ghn1sl4' // Mapbox tileset Map ID
                            },
                            'source-layer': 'Cancer-bcqas9', // name of tilesets
                            'layout': {
                                'visibility': 'none'
                            },
                            paint: {
                                "fill-color": [
                                    'step', ['get', 'cancer_density'],
                                    '#E6EBE6',
                                    3.916922e-05, '#E0F4E9',
                                    4.896153e-05, '#CAE2D2',
                                    6.364998e-05, '#B1D0BD',
                                    7.833844e-05, '#9EC0A5',
                                    8.813075e-05, '#89AD8D',
                                    9.792305e-05, '#799D7C',
                                    1.175077e-04, '#658F67',
                                    1.370923e-04, '#528054',
                                    1.664692e-04, '#417049',
                                    2.056384e-04, '#38623A'
                                ],
                                "fill-outline-color": "hsl(0, 94%, 55%)",
                                'fill-opacity': 0.7
                            }
                        });
                    }
                }


                function showLayer(attribute, otype, mapInstance) {
                    mapInstance.setLayoutProperty('mental-2xzr5u-' + otype, 'visibility', 'none')
                    mapInstance.setLayoutProperty('LQ-3a6h5i-' + otype, 'visibility', 'none')
                    mapInstance.setLayoutProperty('dep3-8zbmzs-' + otype, 'visibility', 'none')
                    mapInstance.setLayoutProperty('dep4-28q6zo-' + otype, 'visibility', 'none')
                    mapInstance.setLayoutProperty('mode-6ka47b-' + otype, 'visibility', 'none')
                    mapInstance.setLayoutProperty('Obesity-6ukcyy-' + otype, 'visibility', 'none')
                    mapInstance.setLayoutProperty('Cancer-bcqas9-' + otype, 'visibility', 'none')
                    mapInstance.setLayoutProperty(attribute + '-' + otype, 'visibility', 'visible')

                    updateLegend(attribute);
                };
                // Create a function to handle the selection of both 'year-select' and 'layer-select' options
                function handleSelection() {

                    let layerSelect = document.getElementById('layer-select');
                    let attribute = layerSelect.value;

                    // Show the selected layer on the map
                    showLayer(attribute, "Left", mapLeft);

                    showLayer(attribute, "Right", mapRight);
                }

                // Add an event listener for 'layer-select' input
                document.getElementById('layer-select').addEventListener('input', (event) => {
                    // Call the handleSelection function when the 'layer-select' option is changed
                    handleSelection();
                });


                document.getElementById("navigateButton").addEventListener("click", function () {
                    window.location.href = "Part2_2.html";
                });



            });
        };
        // Load layers for both maps
        loadLayers("Left", mapLeft);
        // Load layers for both maps
        loadLayers("Right", mapRight);

        mapLeft.on('click', (e) => {
            // 这样点击地图也可以打点了 
            console.log(e.lngLat);

            const features = mapLeft.queryRenderedFeatures(e.point);
            console.log(features);
            const displayProperties = [
                'type',
                'properties',
                'id',
                'layer',
                'source',
                'sourceLayer',
                'state'
            ];

            const displayFeatures = features.map((feat) => {
                const displayFeat = {};
                displayProperties.forEach((prop) => {
                    displayFeat[prop] = feat[prop];
                });
                return displayFeat;
            });

            console.log(displayFeatures)

            displayFeatures.forEach((item, index) => {

                console.log(item)
              

                if (item.layer.id === "mental-2xzr5u-Left") {

                    var Anxiety = item.properties.Anxiety
                    var Depression = item.properties.Depression
                    var Hypertension = item.properties.Hypertension
                    var LSOA11CD = item.properties.LSOA11CD
                    var MentalHealth = item.properties.MentalHealth
                    var density_mental4 = item.properties.density_mental4
                    var mental_acc = item.properties.mental_acc
                    var travel_time = item.properties.mental_acc / item.properties.density_mental4;

                    var description =
                        `<strong>${LSOA11CD}</strong><p>Anxiety:${Anxiety}<br/>Depression:${Depression}<br/>Hypertension:${Hypertension}<br/>MentalHealth:${MentalHealth}<br/>density_mental4:${density_mental4}<br/>mental_acc:${mental_acc}<br/>travel_time:${travel_time}<br/></p>`

                    // create the popup
                    new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML(description)
                        .addTo(mapLeft);
                }

                if (item.layer.id === "LQ-3a6h5i-Left") {

                    var density_LQ = item.properties.density_LQ
                    var LQ_acc = item.properties.LQ_acc
                    var LQ_count = item.properties.LQ_count
                    var LSOA11CD = item.properties.LSOA11CD

                    var travel_time = item.properties.LQ_acc / item.properties.density_LQ;

                    var description =
                        `<strong>${LSOA11CD}</strong><p>LQ_acc:${LQ_acc}<br/>density_LQ:${density_LQ}<br/>LQ_count:${LQ_count}<br/>travel_time:${travel_time}<br/></p>`

                    // create the popup
                    new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML(description)
                        .addTo(mapLeft);
                }

                if (item.layer.id === "dep4-28q6zo-Left") {

                    var acc_4 = item.properties.acc_4
                    var count_dep4 = item.properties.count_dep4
                    var density4 = item.properties.density4
                    var LSOA11CD = item.properties.LSOA11CD

                    var travel_time = item.properties.acc_4 / item.properties.density4;

                    var description =
                        `<strong>${LSOA11CD}</strong><p>acc_4:${acc_4}<br/>density4:${density4}<br/>count_dep4:${count_dep4}<br/>travel_time:${travel_time}<br/></p>`

                    // create the popup
                    new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML(description)
                        .addTo(mapLeft);
                }
                if (item.layer.id === "dep3-8zbmzs-Left") {

                    var acc_3 = item.properties.acc_3
                    var count_dep3 = item.properties.count_dep3
                    var density3 = item.properties.density3
                    var LSOA11CD = item.properties.LSOA11CD

                    var travel_time = item.properties.acc_3 / item.properties.density3;

                    var description =
                        `<strong>${LSOA11CD}</strong><p>acc_3:${acc_3}<br/>density3:${density3}<br/>count_dep3:${count_dep3}<br/>travel_time:${travel_time}<br/></p>`

                    // create the popup
                    new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML(description)
                        .addTo(mapLeft);
                }
                if (item.layer.id === "mode-6ka47b-Left") {

                    var density_mode = item.properties.density_mode
                    var mode_acc = item.properties.mode_acc
                    var mode_count = item.properties.mode_count
                    var LSOA11CD = item.properties.LSOA11CD

                    var travel_time = item.properties.mode_acc / item.properties.density_mode;

                    var description =
                        `<strong>${LSOA11CD}</strong><p>mode_acc:${mode_acc}<br/>density_mode:${density_mode}<br/>mode_count:${mode_count}<br/>travel_time:${travel_time}<br/></p>`

                    // create the popup
                    new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML(description)
                        .addTo(mapLeft);
                }
                if (item.layer.id === "Obesity-6ukcyy-Left") {

                    var count_obesity = item.properties.count_obesity
                    var obesity_acc = item.properties.obesity_acc
                    var obesity_density = item.properties.obesity_density
                    var LSOA11CD = item.properties.LSOA11CD
                    var travel_time = item.properties.obesity_acc / item.properties.obesity_density;

                    var description =
                        `<strong>${LSOA11CD}</strong><p>obesity_acc:${obesity_acc}<br/>obesity_density:${obesity_density}<br/>count_obesity:${count_obesity}<br/>travel_time:${travel_time}<br/></p>`

                    // create the popup
                    new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML(description)
                        .addTo(mapLeft);
                }
                if (item.layer.id === "Cancer-bcqas9-Left") {

                    var cancer_acc = item.properties.cancer_acc
                    var cancer_density = item.properties.cancer_density
                    var count_cancer = item.properties.count_cancer
                    var LSOA11CD = item.properties.LSOA11CD

                    var travel_time = item.properties.cancer_acc / item.properties.cancer_density;

                    var description =
                        `<strong>${LSOA11CD}</strong><p>cancer_acc:${cancer_acc}<br/>cancer_density:${cancer_density}<br/>count_cancer:${count_cancer}<br/>travel_time:${travel_time}<br/></p>`

                    // create the popup
                    new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML(description)
                        .addTo(mapLeft);
                }
                
            })
        })

        mapRight.on('click', (e) => {
            // 这样点击地图也可以打点了 
            console.log('Right:' + e.lngLat);
            const features = mapLeft.queryRenderedFeatures(e.point);
            console.log(features);
            const displayProperties = [
                'type',
                'properties',
                'id',
                'layer',
                'source',
                'sourceLayer',
                'state'
            ];

            const displayFeatures = features.map((feat) => {
                const displayFeat = {};
                displayProperties.forEach((prop) => {
                    displayFeat[prop] = feat[prop];
                });
                return displayFeat;
            });

            console.log(displayFeatures)

            displayFeatures.forEach((item, index) => {

                console.log(item)
                if (item.layer.id === "housing_shp-89k0ag-Left") {
						//console.log(item.properties.id)
						var Name = item.properties.Name
						var id = item.properties.id
						var Type = item.properties.Type
						//var x = item.properties.x
						//var y = item.properties.y
						var description =
							`<strong>${id}</strong><p>Name:${Name}<br/>Type:${Type}<br/></p>` //x:${x}<br/>y:${y}<br/>
						new mapboxgl.Popup()
							.setLngLat(e.lngLat)
							.setHTML(description)
							.addTo(mapRight);
					}

                // if (item.layer.id === "mental-2xzr5u-Left") {

                //     var Anxiety = item.properties.Anxiety
                //     var Depression = item.properties.Depression
                //     var Hypertension = item.properties.Hypertension
                //     var LSOA11CD = item.properties.LSOA11CD
                //     var MentalHealth = item.properties.MentalHealth
                //     var density_mental4 = item.properties.density_mental4
                //     var mental_acc = item.properties.mental_acc
                //     var travel_time = item.properties.mental_acc / item.properties.density_mental4;

                //     var description =
                //         `<strong>${LSOA11CD}</strong><p>Anxiety:${Anxiety}<br/>Depression:${Depression}<br/>Hypertension:${Hypertension}<br/>MentalHealth:${MentalHealth}<br/>density_mental4:${density_mental4}<br/>mental_acc:${mental_acc}<br/>travel_time:${travel_time}<br/></p>`

                //     // create the popup
                //     new mapboxgl.Popup()
                //         .setLngLat(e.lngLat)
                //         .setHTML(description)
                //         .addTo(mapRight);
                // }

                // if (item.layer.id === "LQ-3a6h5i-Left") {

                //     var density_LQ = item.properties.density_LQ
                //     var LQ_acc = item.properties.LQ_acc
                //     var LQ_count = item.properties.LQ_count
                //     var LSOA11CD = item.properties.LSOA11CD

                //     var travel_time = item.properties.LQ_acc / item.properties.density_LQ;

                //     var description =
                //         `<strong>${LSOA11CD}</strong><p>LQ_acc:${LQ_acc}<br/>density_LQ:${density_LQ}<br/>LQ_count:${LQ_count}<br/>travel_time:${travel_time}<br/></p>`

                //     // create the popup
                //     new mapboxgl.Popup()
                //         .setLngLat(e.lngLat)
                //         .setHTML(description)
                //         .addTo(mapRight);
                // }

                // if (item.layer.id === "dep4-28q6zo-Left") {

                //     var acc_4 = item.properties.acc_4
                //     var count_dep4 = item.properties.count_dep4
                //     var density4 = item.properties.density4
                //     var LSOA11CD = item.properties.LSOA11CD

                //     var travel_time = item.properties.acc_4 / item.properties.density4;

                //     var description =
                //         `<strong>${LSOA11CD}</strong><p>acc_4:${acc_4}<br/>density4:${density4}<br/>count_dep4:${count_dep4}<br/>travel_time:${travel_time}<br/></p>`

                //     // create the popup
                //     new mapboxgl.Popup()
                //         .setLngLat(e.lngLat)
                //         .setHTML(description)
                //         .addTo(mapRight);
                // }
                // if (item.layer.id === "dep3-8zbmzs-Left") {

                //     var acc_3 = item.properties.acc_3
                //     var count_dep3 = item.properties.count_dep3
                //     var density3 = item.properties.density3
                //     var LSOA11CD = item.properties.LSOA11CD

                //     var travel_time = item.properties.acc_3 / item.properties.density3;

                //     var description =
                //         `<strong>${LSOA11CD}</strong><p>acc_3:${acc_3}<br/>density3:${density3}<br/>count_dep3:${count_dep3}<br/>travel_time:${travel_time}<br/></p>`

                //     // create the popup
                //     new mapboxgl.Popup()
                //         .setLngLat(e.lngLat)
                //         .setHTML(description)
                //         .addTo(mapRight);
                // }
                // if (item.layer.id === "mode-6ka47b-Left") {

                //     var density_mode = item.properties.density_mode
                //     var mode_acc = item.properties.mode_acc
                //     var mode_count = item.properties.mode_count
                //     var LSOA11CD = item.properties.LSOA11CD

                //     var travel_time = item.properties.mode_acc / item.properties.density_mode;

                //     var description =
                //         `<strong>${LSOA11CD}</strong><p>mode_acc:${mode_acc}<br/>density_mode:${density_mode}<br/>mode_count:${mode_count}<br/>travel_time:${travel_time}<br/></p>`

                //     // create the popup
                //     new mapboxgl.Popup()
                //         .setLngLat(e.lngLat)
                //         .setHTML(description)
                //         .addTo(mapRight);
                // }
                // if (item.layer.id === "Obesity-6ukcyy-Left") {

                //     var count_obesity = item.properties.count_obesity
                //     var obesity_acc = item.properties.obesity_acc
                //     var obesity_density = item.properties.obesity_density
                //     var LSOA11CD = item.properties.LSOA11CD
                //     var travel_time = item.properties.obesity_acc / item.properties.obesity_density;

                //     var description =
                //         `<strong>${LSOA11CD}</strong><p>obesity_acc:${obesity_acc}<br/>obesity_density:${obesity_density}<br/>count_obesity:${count_obesity}<br/>travel_time:${travel_time}<br/></p>`

                //     // create the popup
                //     new mapboxgl.Popup()
                //         .setLngLat(e.lngLat)
                //         .setHTML(description)
                //         .addTo(mapRight);
                // }
                // if (item.layer.id === "Cancer-bcqas9-Left") {

                //     var cancer_acc = item.properties.cancer_acc
                //     var cancer_density = item.properties.cancer_density
                //     var count_cancer = item.properties.count_cancer
                //     var LSOA11CD = item.properties.LSOA11CD

                //     var travel_time = item.properties.cancer_acc / item.properties.cancer_density;

                //     var description =
                //         `<strong>${LSOA11CD}</strong><p>cancer_acc:${cancer_acc}<br/>cancer_density:${cancer_density}<br/>count_cancer:${count_cancer}<br/>travel_time:${travel_time}<br/></p>`

                //     // create the popup
                //     new mapboxgl.Popup()
                //         .setLngLat(e.lngLat)
                //         .setHTML(description)
                //         .addTo(mapRight);
                // }
            })
        })
    </script>
</body>

</html>